<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #gameContainer {
            position: relative;
            background: #2c3e50;
            border-radius: 10px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            width: 90vw;
            height: 90vw;
            max-width: 800px;
            max-height: 800px;
        }

        #gameCanvas {
            display: block;
            background: #3498db;
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 800px;
        }

        .menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .hidden {
            display: none !important;
        }

        .button {
            padding: 15px 40px;
            margin: 10px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            background: #27ae60;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }

        .button:hover {
            background: #2ecc71;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.6);
        }

        .small-button {
            padding: 10px 25px;
            font-size: 16px;
        }

        .username-label {
            color: white;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .highscore-text {
            color: #bdc3c7;
            font-size: 18px;
            margin-top: 20px;
        }

        .info-corner {
            position: absolute;
            bottom: 15px;
            right: 15px;
            text-align: right;
            color: #95a5a6;
            font-size: 12px;
        }

        .settings-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .settings-icon:hover {
            transform: rotate(90deg);
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 30px;
            color: white;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
            transition: all 0.3s;
        }

        .close-button:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .leaderboard-list {
            margin-top: 30px;
            width: 400px;
            max-width: 90%;
            max-height: 400px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .leaderboard-item.top3 {
            font-weight: bold;
            color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .leaderboard-item.normal {
            color: #95a5a6;
        }

        .delete-icon {
            cursor: pointer;
            font-size: 20px;
            color: #e74c3c;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .delete-icon:hover {
            color: #c0392b;
            transform: scale(1.2);
        }

        .input-field {
            padding: 12px 20px;
            font-size: 18px;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin: 10px;
            width: 300px;
            max-width: 90%;
        }

        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px 40px;
            border-radius: 10px;
            pointer-events: none;
        }

        .theme-option {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .theme-option.selected {
            background: rgba(52, 152, 219, 0.5);
            border: 2px solid #3498db;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            min-height: 20px;
        }

        .staff-link {
            position: absolute;
            bottom: 15px;
            left: 15px;
            color: #3498db;
            font-size: 12px;
            cursor: pointer;
            text-decoration: underline;
        }

        .staff-link:hover {
            color: #2980b9;
        }

        .setting-group {
            margin: 20px 0;
            width: 100%;
            max-width: 500px;
        }

        .setting-label {
            color: white;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .dropdown {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border-radius: 5px;
            border: 2px solid #3498db;
            background: white;
        }

        .color-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .color-input {
            flex: 1;
        }

        .settings-scroll {
            max-height: 60vh;
            overflow-y: auto;
            padding: 0 20px;
            width: 100%;
        }

        .logout-button {
            margin-top: 20px;
            padding: 12px 30px;
            font-size: 18px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        h1 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 28px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="320" height="320"></canvas>
        
        <!-- Username Input Menu -->
        <div id="usernameMenu" class="menu hidden">
            <h1>Welcome to Snake Game</h1>
            <p style="font-size: 18px; margin-bottom: 20px;">Enter your username to continue</p>
            <input type="text" id="usernameInput" class="input-field" placeholder="Enter username" maxlength="20">
            <div class="error-message" id="usernameError"></div>
            <button class="button small-button" onclick="submitUsername()">Submit</button>
            <div class="staff-link" onclick="showStaffLogin()">Staff Login</div>
        </div>

        <!-- Staff Login Menu -->
        <div id="staffLoginMenu" class="menu hidden">
            <h2>Staff Login</h2>
            <input type="text" id="staffUsername" class="input-field" placeholder="Username">
            <input type="password" id="staffPassword" class="input-field" placeholder="Password">
            <div class="error-message" id="staffError"></div>
            <button class="button small-button" onclick="submitStaffLogin()">Login</button>
            <button class="button small-button" onclick="backToUsernameMenu()">Back</button>
        </div>

        <!-- Start Menu -->
        <div id="startMenu" class="menu hidden">
            <h1>Snake Game</h1>
            <button class="button" onclick="startGame()">Play</button>
            <div class="username-label" id="usernameDisplay"></div>
            <div class="highscore-text" id="highscoreDisplay">HighScore: 0</div>
            <button class="button small-button" onclick="showLeaderboard()">LeaderBoard</button>
            
            <div class="info-corner">
                <div>V1</div>
                <div>MadeBy Flwl3y</div>
            </div>
            
            <svg class="settings-icon" onclick="showSettings()" viewBox="0 0 24 24" fill="white">
                <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
            </svg>
        </div>

        <!-- Settings Menu -->
        <div id="settingsMenu" class="menu hidden">
            <h2>Settings</h2>
            <div class="settings-scroll">
                <p style="font-size: 18px; margin-bottom: 20px;">Choose Food Theme</p>
                
                <div class="theme-option" id="defaultTheme" onclick="selectTheme('default')">
                    <div style="font-size: 20px; margin-bottom: 10px;">Default Theme</div>
                    <div>üçé Normal Food (1 point)</div>
                    <div>üçè Rare Food (5 points, 2% chance)</div>
                </div>
                
                <div class="theme-option" id="fastfoodTheme" onclick="selectTheme('fastfood')">
                    <div style="font-size: 20px; margin-bottom: 10px;">Fast Food Theme</div>
                    <div>üçî Normal Food (1 point)</div>
                    <div>üçï Rare Food (5 points, 2% chance)</div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">Snake Skin</div>
                    <select class="dropdown" id="skinSelect" onchange="changeSkin()">
                        <option value="green">Green</option>
                        <option value="blue">Blue</option>
                        <option value="red">Red</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <div class="setting-group" id="customSkinGroup" style="display: none;">
                    <div class="setting-label">Custom Skin</div>
                    <div class="color-input-group">
                        <input type="text" class="input-field color-input" id="headColorInput" placeholder="Head Hex (#27ae60)" maxlength="7">
                        <input type="text" class="input-field color-input" id="bodyColorInput" placeholder="Body Hex (#2ecc71)" maxlength="7">
                    </div>
                    <button class="button small-button" onclick="applyCustomColors()">Apply Custom Colors</button>
                </div>
            </div>

            <button class="logout-button" onclick="logout()">Logout</button>
            
            <div class="close-button" onclick="closeSettings()">√ó</div>
        </div>

        <!-- Leaderboard Menu -->
        <div id="leaderboardMenu" class="menu hidden">
            <h2>World Leaderboard</h2>
            <div class="leaderboard-list" id="leaderboardList"></div>
            <div class="close-button" onclick="closeLeaderboard()">√ó</div>
        </div>

        <!-- Game Over Menu -->
        <div id="gameOverMenu" class="menu hidden">
            <h2>Game Over!</h2>
            <p style="font-size: 24px; margin: 20px 0;" id="finalScore"></p>
            <button class="button" onclick="returnToMenu()">Return to Menu</button>
        </div>

        <!-- Game Start Message -->
        <div id="startMessage" class="game-message hidden">
            Press an arrow key to start
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 20;
        const tileCount = 16;

        let gameData = {
            username: null,
            highScore: 0,
            theme: 'default',
            deviceId: null,
            isStaff: false,
            snakeSkin: 'green',
            customHeadColor: '#27ae60',
            customBodyColor: '#2ecc71'
        };

        const skinColors = {
            green: { head: '#27ae60', body: '#2ecc71' },
            blue: { head: '#2980b9', body: '#3498db' },
            red: { head: '#c0392b', body: '#e74c3c' },
            custom: { head: '#27ae60', body: '#2ecc71' }
        };

        let snake = [];
        let direction = { x: 0, y: 0 };
        let food = { x: 10, y: 10, value: 1, emoji: 'üçé' };
        let score = 0;
        let gameRunning = false;
        let gameStarted = false;
        let gameLoop = null;

        function getLocalData(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                return null;
            }
        }

        function setLocalData(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (e) {
                console.error('Failed to save data:', e);
                return false;
            }
        }

        function getAllLeaderboardData() {
            const leaderboard = getLocalData('snakeGame_globalLeaderboard') || [];
            return leaderboard;
        }

        function saveToGlobalLeaderboard(username, score) {
            let leaderboard = getAllLeaderboardData();
            
            const existingIndex = leaderboard.findIndex(entry => entry.username === username);
            
            if (existingIndex >= 0) {
                if (score > leaderboard[existingIndex].score) {
                    leaderboard[existingIndex].score = score;
                    leaderboard[existingIndex].timestamp = Date.now();
                }
            } else {
                leaderboard.push({
                    username: username,
                    score: score,
                    timestamp: Date.now()
                });
            }
            
            leaderboard.sort((a, b) => b.score - a.score);
            
            setLocalData('snakeGame_globalLeaderboard', leaderboard);
        }

        function deleteUserFromLeaderboard(username) {
            let leaderboard = getAllLeaderboardData();
            leaderboard = leaderboard.filter(entry => entry.username !== username);
            setLocalData('snakeGame_globalLeaderboard', leaderboard);
            
            let allUsers = getLocalData('snakeGame_allUsers') || [];
            allUsers = allUsers.filter(user => user !== username);
            setLocalData('snakeGame_allUsers', allUsers);
        }

        function isUsernameTaken(username) {
            const leaderboard = getAllLeaderboardData();
            const allUsers = getLocalData('snakeGame_allUsers') || [];
            
            const inLeaderboard = leaderboard.some(entry => 
                entry.username.toLowerCase() === username.toLowerCase()
            );
            
            const inUserList = allUsers.some(user => 
                user.toLowerCase() === username.toLowerCase()
            );
            
            return inLeaderboard || inUserList;
        }

        function registerUsername(username) {
            const allUsers = getLocalData('snakeGame_allUsers') || [];
            if (!allUsers.includes(username)) {
                allUsers.push(username);
                setLocalData('snakeGame_allUsers', allUsers);
            }
        }

        function init() {
            generateDeviceId();
            loadGameData();
            
            if (!gameData.username) {
                showMenu('usernameMenu');
            } else {
                showMenu('startMenu');
                updateStartMenuDisplay();
            }

            document.addEventListener('keydown', handleKeyPress);
            drawGrid();
            syncLeaderboardPeriodically();
        }

        function generateDeviceId() {
            let deviceId = localStorage.getItem('snakeGameDeviceId');
            if (!deviceId) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + Date.now();
                localStorage.setItem('snakeGameDeviceId', deviceId);
            }
            gameData.deviceId = deviceId;
        }

        function loadGameData() {
            const savedData = getLocalData('gameData_' + gameData.deviceId);
            if (savedData) {
                gameData.username = savedData.username;
                gameData.highScore = savedData.highScore || 0;
                gameData.theme = savedData.theme || 'default';
                gameData.isStaff = savedData.isStaff || false;
                gameData.snakeSkin = savedData.snakeSkin || 'green';
                gameData.customHeadColor = savedData.customHeadColor || '#27ae60';
                gameData.customBodyColor = savedData.customBodyColor || '#2ecc71';
            }
        }

        function saveGameData() {
            setLocalData('gameData_' + gameData.deviceId, {
                username: gameData.username,
                highScore: gameData.highScore,
                theme: gameData.theme,
                isStaff: gameData.isStaff,
                snakeSkin: gameData.snakeSkin,
                customHeadColor: gameData.customHeadColor,
                customBodyColor: gameData.customBodyColor
            });
        }

        function updateLeaderboard() {
            if (score > 0 && gameData.username) {
                const finalScore = Math.max(score, gameData.highScore);
                saveToGlobalLeaderboard(gameData.username, finalScore);
            }
        }

        function getLeaderboard() {
            const leaderboard = getAllLeaderboardData();
            return leaderboard.slice(0, 9);
        }

        function syncLeaderboardPeriodically() {
            setInterval(() => {
                if (gameData.highScore > 0 && gameData.username) {
                    saveToGlobalLeaderboard(gameData.username, gameData.highScore);
                }
            }, 300000);
        }

        function showStaffLogin() {
            showMenu('staffLoginMenu');
        }

        function backToUsernameMenu() {
            showMenu('usernameMenu');
        }

        function submitStaffLogin() {
            const username = document.getElementById('staffUsername').value.trim();
            const password = document.getElementById('staffPassword').value;
            const errorElement = document.getElementById('staffError');
            
            if (username === 'Flowl3yStaff' && password === 'Flowl3yIsRunning!') {
                gameData.username = username;
                gameData.isStaff = true;
                registerUsername(username);
                saveGameData();
                errorElement.textContent = '';
                showMenu('startMenu');
                updateStartMenuDisplay();
            } else {
                errorElement.textContent = 'Invalid credentials';
            }
        }

        function submitUsername() {
            const username = document.getElementById('usernameInput').value.trim();
            const errorElement = document.getElementById('usernameError');
            
            if (username.length < 1) {
                errorElement.textContent = 'Please enter a username';
                return;
            }
            
            if (username.length < 3) {
                errorElement.textContent = 'Username must be at least 3 characters';
                return;
            }
            
            if (isUsernameTaken(username)) {
                errorElement.textContent = 'Username already taken. Please choose another.';
                return;
            }
            
            gameData.username = username;
            registerUsername(username);
            saveGameData();
            
            errorElement.textContent = '';
            showMenu('startMenu');
            updateStartMenuDisplay();
        }

        function updateStartMenuDisplay() {
            document.getElementById('usernameDisplay').textContent = gameData.username;
            document.getElementById('highscoreDisplay').textContent = `HighScore: ${gameData.highScore}`;
            updateThemeSelection();
            updateSkinSelection();
        }

        function showMenu(menuId) {
            const menus = ['usernameMenu', 'staffLoginMenu', 'startMenu', 'settingsMenu', 'leaderboardMenu', 'gameOverMenu', 'startMessage'];
            menus.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(menuId).classList.remove('hidden');
        }

        function startGame() {
            showMenu('startMessage');
            gameStarted = false;
            gameRunning = false;
            score = 0;
            direction = { x: 0, y: 0 };
            
            snake = [
                { x: 8, y: 8 },
                { x: 7, y: 8 },
                { x: 6, y: 8 }
            ];
            
            spawnFood();
        }

        function actuallyStartGame() {
            gameStarted = true;
            gameRunning = true;
            document.getElementById('startMessage').classList.add('hidden');
            
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(update, 150);
        }

        function handleKeyPress(e) {
            if (!gameStarted && !gameRunning) {
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    
                    if (e.key === 'ArrowUp' && direction.y === 0) {
                        direction = { x: 0, y: -1 };
                    } else if (e.key === 'ArrowDown' && direction.y === 0) {
                        direction = { x: 0, y: 1 };
                    } else if (e.key === 'ArrowLeft' && direction.x === 0) {
                        direction = { x: -1, y: 0 };
                    } else if (e.key === 'ArrowRight' && direction.x === 0) {
                        direction = { x: 1, y: 0 };
                    }
                    
                    actuallyStartGame();
                }
                return;
            }

            if (!gameRunning) return;

            if (e.key === 'ArrowUp' && direction.y === 0) {
                direction = { x: 0, y: -1 };
                e.preventDefault();
            } else if (e.key === 'ArrowDown' && direction.y === 0) {
                direction = { x: 0, y: 1 };
                e.preventDefault();
            } else if (e.key === 'ArrowLeft' && direction.x === 0) {
                direction = { x: -1, y: 0 };
                e.preventDefault();
            } else if (e.key === 'ArrowRight' && direction.x === 0) {
                direction = { x: 1, y: 0 };
                e.preventDefault();
            }
        }

        function update() {
            if (!gameRunning) return;

            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }

            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    gameOver();
                    return;
                }
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score += food.value;
                spawnFood();
            } else {
                snake.pop();
            }

            draw();
        }

        function spawnFood() {
            const isRare = Math.random() < 0.02;
            food.value = isRare ? 5 : 1;
            
            if (gameData.theme === 'fastfood') {
                food.emoji = isRare ? 'üçï' : 'üçî';
            } else {
                food.emoji = isRare ? 'üçè' : 'üçé';
            }

            do {
                food.x = Math.floor(Math.random() * tileCount);
                food.y = Math.floor(Math.random() * tileCount);
            } while (snake.some(segment => segment.x === food.x && segment.y === food.y));
        }

        function drawGrid() {
            ctx.fillStyle = '#3498db';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }
        }

        function draw() {
            drawGrid();

            ctx.font = `${gridSize - 2}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(food.emoji, food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2);

            snake.forEach((segment, index) => {
                if (index === 0) {
                    drawSnakeHead(segment);
                } else {
                    drawSnakeBody(segment);
                }
            });

            ctx.fillStyle = 'white';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Score: ${score}`, 10, 30);
        }

        function getCurrentSnakeColors() {
            if (gameData.snakeSkin === 'custom') {
                return {
                    head: gameData.customHeadColor,
                    body: gameData.customBodyColor
                };
            }
            return skinColors[gameData.snakeSkin];
        }

        function drawSnakeHead(segment) {
            const x = segment.x * gridSize;
            const y = segment.y * gridSize;
            const centerX = x + gridSize / 2;
            const centerY = y + gridSize / 2;
            const colors = getCurrentSnakeColors();

            ctx.save();
            ctx.translate(centerX, centerY);

            let angle = 0;
            if (direction.x === 1) angle = 0;
            else if (direction.x === -1) angle = Math.PI;
            else if (direction.y === 1) angle = Math.PI / 2;
            else if (direction.y === -1) angle = -Math.PI / 2;
            ctx.rotate(angle);

            ctx.fillStyle = colors.head;
            ctx.beginPath();
            ctx.ellipse(0, 0, gridSize / 2 - 1, gridSize / 2.5 - 1, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(-gridSize / 6, -gridSize / 6, gridSize / 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(-gridSize / 6, gridSize / 6, gridSize / 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(-gridSize / 6, -gridSize / 6, gridSize / 16, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(-gridSize / 6, gridSize / 6, gridSize / 16, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawSnakeBody(segment) {
            const x = segment.x * gridSize;
            const y = segment.y * gridSize;
            const colors = getCurrentSnakeColors();

            ctx.fillStyle = colors.body;
            ctx.beginPath();
            ctx.ellipse(x + gridSize / 2, y + gridSize / 2, gridSize / 2 - 2, gridSize / 3 - 2, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function gameOver() {
            gameRunning = false;
            gameStarted = false;
            clearInterval(gameLoop);

            if (score > gameData.highScore) {
                gameData.highScore = score;
                saveGameData();
            }

            updateLeaderboard();

            document.getElementById('finalScore').textContent = `You died at ${score} points`;
            showMenu('gameOverMenu');
        }

        function returnToMenu() {
            showMenu('startMenu');
            updateStartMenuDisplay();
            drawGrid();
        }

        function showLeaderboard() {
            const leaderboard = getLeaderboard();
            const listElement = document.getElementById('leaderboardList');
            listElement.innerHTML = '';

            if (leaderboard.length === 0) {
                listElement.innerHTML = '<div style="text-align: center; color: #95a5a6;">No scores yet</div>';
            } else {
                leaderboard.forEach((entry, index) => {
                    const item = document.createElement('div');
                    item.className = index < 3 ? 'leaderboard-item top3' : 'leaderboard-item normal';
                    
                    const leftSpan = document.createElement('span');
                    leftSpan.textContent = `${index + 1}. ${entry.username}`;
                    
                    const rightDiv = document.createElement('div');
                    rightDiv.style.display = 'flex';
                    rightDiv.style.alignItems = 'center';
                    
                    const scoreSpan = document.createElement('span');
                    scoreSpan.textContent = entry.score;
                    rightDiv.appendChild(scoreSpan);
                    
                    if (gameData.isStaff) {
                        const deleteIcon = document.createElement('span');
                        deleteIcon.className = 'delete-icon';
                        deleteIcon.textContent = 'üóëÔ∏è';
                        deleteIcon.onclick = () => {
                            if (confirm(`Delete ${entry.username} from leaderboard?`)) {
                                deleteUserFromLeaderboard(entry.username);
                                showLeaderboard();
                            }
                        };
                        rightDiv.appendChild(deleteIcon);
                    }
                    
                    item.appendChild(leftSpan);
                    item.appendChild(rightDiv);
                    listElement.appendChild(item);
                });
            }

            showMenu('leaderboardMenu');
        }

        function closeLeaderboard() {
            showMenu('startMenu');
        }

        function showSettings() {
            showMenu('settingsMenu');
        }

        function closeSettings() {
            showMenu('startMenu');
        }

        function selectTheme(theme) {
            gameData.theme = theme;
            saveGameData();
            updateThemeSelection();
        }

        function updateThemeSelection() {
            document.getElementById('defaultTheme').classList.remove('selected');
            document.getElementById('fastfoodTheme').classList.remove('selected');
            
            if (gameData.theme === 'fastfood') {
                document.getElementById('fastfoodTheme').classList.add('selected');
            } else {
                document.getElementById('defaultTheme').classList.add('selected');
            }
        }

        function changeSkin() {
            const skin = document.getElementById('skinSelect').value;
            gameData.snakeSkin = skin;
            
            if (skin === 'custom') {
                document.getElementById('customSkinGroup').style.display = 'block';
                document.getElementById('headColorInput').value = gameData.customHeadColor;
                document.getElementById('bodyColorInput').value = gameData.customBodyColor;
            } else {
                document.getElementById('customSkinGroup').style.display = 'none';
            }
            
            saveGameData();
        }

        function updateSkinSelection() {
            document.getElementById('skinSelect').value = gameData.snakeSkin;
            if (gameData.snakeSkin === 'custom') {
                document.getElementById('customSkinGroup').style.display = 'block';
                document.getElementById('headColorInput').value = gameData.customHeadColor;
                document.getElementById('bodyColorInput').value = gameData.customBodyColor;
            }
        }

        function applyCustomColors() {
            const headColor = document.getElementById('headColorInput').value.trim();
            const bodyColor = document.getElementById('bodyColorInput').value.trim();
            
            const hexPattern = /^#[0-9A-Fa-f]{6}$/;
            
            if (hexPattern.test(headColor) && hexPattern.test(bodyColor)) {
                gameData.customHeadColor = headColor;
                gameData.customBodyColor = bodyColor;
                saveGameData();
                alert('Custom colors applied!');
            } else {
                alert('Please enter valid hex colors (e.g., #27ae60)');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout? This will clear your device data.')) {
                localStorage.removeItem('gameData_' + gameData.deviceId);
                gameData.username = null;
                gameData.highScore = 0;
                gameData.isStaff = false;
                gameData.snakeSkin = 'green';
                gameData.customHeadColor = '#27ae60';
                gameData.customBodyColor = '#2ecc71';
                showMenu('usernameMenu');
            }
        }

        init();
    </script>
</body>
</html>